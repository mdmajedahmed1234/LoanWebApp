<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LisnWebApp - ঋণ ও খরচ হিসাব</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
<style>
body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
.container { margin-top: 40px; }
table th { background-color: #0d6efd; color: white; }
.summary-card { background-color: #ffffff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-top: 20px; }
</style>
</head>
<body>

<div class="container">
  <h1 class="text-center mb-4">LisnWebApp - ঋণ ও খরচ হিসাব</h1>

  <!-- Input Card -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">নতুন এন্ট্রি যোগ করুন</h5>
      <div class="row g-2">
        <div class="col-md-3">
          <input type="text" id="entryName" class="form-control" placeholder="নাম/Item">
        </div>
        <div class="col-md-2">
          <input type="number" id="entryAmount" class="form-control" placeholder="মোট টাকা">
        </div>
        <div class="col-md-2">
          <input type="number" id="entryInstallment" class="form-control" placeholder="মাসিক কিস্তি">
        </div>
        <div class="col-md-2">
          <input type="number" id="entrySaving" class="form-control" placeholder="সঞ্চয়/Extra">
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary w-100" onclick="addEntry()">Add Entry</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">তালিকা</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered text-center" id="entryTable">
          <thead>
            <tr>
              <th>নাম</th>
              <th>মোট</th>
              <th>মাসিক কিস্তি/খরচ</th>
              <th>সঞ্চয়</th>
              <th>বাকি মাস</th>
              <th>মোট পরিশোধিত</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Summary Card -->
  <div class="summary-card d-flex justify-content-around text-center flex-wrap">
    <div class="me-3"><strong>মোট:</strong> <span id="totalAmount">0</span> টাকা</div>
    <div class="me-3"><strong>মোট পরিশোধিত:</strong> <span id="totalPaid">0</span> টাকা</div>
    <div class="me-3"><strong>মোট সঞ্চয়:</strong> <span id="totalSaving">0</span> টাকা</div>
    <div><strong>মোট বাকি:</strong> <span id="totalRemaining">0</span> টাকা</div>
  </div>
</div>

<script>
// Firebase Configuration - Replace with your project details
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "lisnwebapp.firebaseapp.com",
  projectId: "lisnwebapp",
  storageBucket: "lisnwebapp.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Add Entry with optional numeric fields
function addEntry() {
  const name = document.getElementById('entryName').value.trim();
  let amount = parseFloat(document.getElementById('entryAmount').value);
  let installment = parseFloat(document.getElementById('entryInstallment').value);
  let saving = parseFloat(document.getElementById('entrySaving').value);

  // Optional fields default to 0
  amount = isNaN(amount) ? 0 : amount;
  installment = isNaN(installment) ? 0 : installment;
  saving = isNaN(saving) ? 0 : saving;

  if(!name){
    alert("নাম অবশ্যই লিখতে হবে");
    return;
  }

  // Add to Firebase
  db.collection("entries").add({ name, amount, installment, saving })
    .then(() => {
      updateTable();
      // Clear inputs
      document.getElementById('entryName').value = '';
      document.getElementById('entryAmount').value = '';
      document.getElementById('entryInstallment').value = '';
      document.getElementById('entrySaving').value = '';
    });
}

// Update Table & Summary
function updateTable() {
  const tbody = document.querySelector('#entryTable tbody');
  tbody.innerHTML = '';
  let totalAmount = 0, totalPaid = 0, totalSaving = 0;

  db.collection("entries").get().then(snapshot => {
    snapshot.forEach(doc => {
      const e = doc.data();
      const paid = e.installment;
      const remainingMonths = e.installment > 0 ? Math.ceil((e.amount - paid)/e.installment) : 0;

      tbody.innerHTML += `<tr>
        <td>${e.name}</td>
        <td>${e.amount}</td>
        <td>${e.installment}</td>
        <td>${e.saving}</td>
        <td>${remainingMonths}</td>
        <td>${paid}</td>
      </tr>`;

      totalAmount += e.amount;
      totalPaid += paid;
      totalSaving += e.saving;
    });

    document.getElementById('totalAmount').innerText = totalAmount;
    document.getElementById('totalPaid').innerText = totalPaid;
    document.getElementById('totalSaving').innerText = totalSaving;
    document.getElementById('totalRemaining').innerText = totalAmount - totalPaid;
  });
}

updateTable();
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>